<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BIO150S - IES San Diego</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #0056b3; --danger: #e63946; --success: #2a9d8f; --bg: #f0f2f5; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .app-card { background: white; border-radius: 25px; padding: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); max-width: 450px; margin: auto; }
        /* Contenedor de imagen optimizado */
        .img-container { width: 100%; height: 220px; border-radius: 15px; overflow: hidden; margin-bottom: 15px; background: #eee; display: flex; align-items: center; justify-content: center; }
        .machine-img { width: 100%; height: 100%; object-fit: contain; }
        h1 { font-size: 1.4rem; color: var(--primary); text-align: center; margin: 5px 0; }
        .timer { font-size: 3.5rem; font-weight: bold; text-align: center; margin: 15px 0; font-family: monospace; }
        .btn { border: none; border-radius: 15px; padding: 18px; font-size: 1.1rem; font-weight: bold; width: 100%; margin-bottom: 10px; transition: 0.3s; }
        .btn-start { background: var(--primary); color: white; }
        .btn-start:disabled { background: #ccc; }
        .btn-stop { background: var(--danger); color: white; display: none; }
        .maint-sec { margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; }
        .bar-bg { background: #e9ecef; height: 12px; border-radius: 6px; margin: 8px 0 15px; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--success); width: 100%; transition: 0.5s; }
        .check-box { background: #fff3cd; padding: 15px; border-radius: 15px; margin-bottom: 15px; font-size: 0.9rem; }
        .check-item { display: flex; align-items: center; margin-bottom: 10px; }
        .check-item input { width: 22px; height: 22px; margin-right: 12px; }
    </style>
</head>
<body>

<div class="app-card">
    <div class="img-container">
        <img src="https://www.anova.es/wp-content/uploads/2019/11/BIO150S-3.jpg" alt="BIO150S" class="machine-img" onerror="this.src='https://via.placeholder.com/400x300?text=BIO150S+ANOVA'">
    </div>
    
    <h1>IES San Diego de Alcal√°</h1>
    <p style="text-align: center; font-size: 0.8rem; color: #666;">Control Profesional de Triturado</p>

    <div class="check-box" id="checklist">
        <strong>‚ö†Ô∏è SEGURIDAD (Manual P√°g. 8):</strong>
        <label class="check-item"><input type="checkbox" onchange="val()"> Aceite 10W-30 (1.2L)</label>
        <label class="check-item"><input type="checkbox" onchange="val()"> Grasa de Litio en rodamientos</label>
        <label class="check-item"><input type="checkbox" onchange="val()"> EPIs y Distancia 15m</label>
    </div>

    <input type="text" id="prof" placeholder="üë§ Nombre del Profesor" oninput="val()" style="width:100%; padding:15px; border-radius:12px; border:1px solid #ddd; margin-bottom:15px; font-size:1rem; box-sizing:border-box;">

    <div class="timer" id="time">00:00</div>

    <button id="go" class="btn btn-start" onclick="start()" disabled>INICIAR MOTOR</button>
    <button id="end" class="btn btn-stop" onclick="stop()">DETENER Y GUARDAR</button>

    <div class="maint-sec">
        <div style="font-size: 0.8rem; font-weight: bold;">ACEITE MOTOR (Pr√≥x. 25h / Inicial 5h)</div>
        <div class="bar-bg"><div id="oilB" class="bar-fill"></div></div>
        
        <div style="font-size: 0.8rem; font-weight: bold;">LIMPIEZA ALETAS (Cada 5h)</div>
        <div class="bar-bg"><div id="cleanB" class="bar-fill"></div></div>
        
        <div style="font-size: 0.8rem; font-weight: bold;">BUJ√çA Y FILTRO (Cada 100h)</div>
        <div class="bar-bg"><div id="majorB" class="bar-fill"></div></div>
    </div>

    <button class="btn" style="background:#333; color:white; margin-top:15px;" onclick="doPDF()">DESCARGAR REPORTE PDF</button>
</div>

<script>
    let t, s, d = JSON.parse(localStorage.getItem('bio_vFinal')) || { tot: 0, lO: 0, lC: 0, lM: 0 };
    
    function val() {
        const c = document.querySelectorAll('#checklist input:checked').length === 3;
        const n = document.getElementById('prof').value.length > 3;
        document.getElementById('go').disabled = !(c && n);
    }

    function start() {
        s = Date.now();
        document.getElementById('go').style.display = 'none';
        document.getElementById('end').style.display = 'block';
        document.getElementById('checklist').style.opacity = '0.3';
        t = setInterval(() => {
            let n = new Date(Date.now() - s);
            document.getElementById('time').innerText = n.toISOString().substr(14, 5);
        }, 1000);
    }

    function stop() {
        clearInterval(t);
        let h = (Date.now() - s) / 3600000;
        d.tot += h;
        localStorage.setItem('bio_vFinal', JSON.stringify(d));
        location.reload();
    }

    function bars() {
        updateB('oilB', d.tot - d.lO, d.lO === 0 ? 5 : 25);
        updateB('cleanB', d.tot - d.lC, 5);
        updateB('majorB', d.tot - d.lM, 100);
    }

    function updateB(id, cur, lim) {
        let p = Math.max(0, 100 - (cur / lim * 100));
        let e = document.getElementById(id);
        e.style.width = p + "%";
        if(p < 20) e.style.background = "var(--danger)";
    }

    function doPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("IES SAN DIEGO DE ALCALA - BIO150S", 20, 20);
        doc.text("Horas Totales: " + d.tot.toFixed(2) + " h", 20, 30);
        doc.save("reporte.pdf");
    }
    bars();
</script>
</body>
</html>
